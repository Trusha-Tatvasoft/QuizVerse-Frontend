<div class="auth-main-container">
  <!-- Back to Sign In link -->
  <div class="back-link-container">
    <a href="/login" class="back-link">
      <img src="assets/images/back-arrow.svg" alt="Back" class="back-arrow-icon" />
      Back to Sign In
    </a>
  </div>

  <!-- Card wrapper for form content -->
  <div class="auth-card">
    <!-- Logo icon -->
    <div class="logo pb-4">
      <mat-icon class="material-icons-outlined">lock</mat-icon>
    </div>

    <!-- Heading and subtext -->
    <div class="auth-header">
      <h1>Reset Your Password</h1>
      <p class="subtext">Enter your new password below</p>
    </div>

    <!-- Reactive form for reset password -->
    <form [formGroup]="resetForm" (ngSubmit)="onSubmit()">
      <!-- Render each form field dynamically -->
      @for (field of resetFields; track field.name) {
        <div class="form-field">
          <label [for]="field.name">{{ field.label }}</label>

          <!-- Input group with icon and toggle visibility button -->
          <div class="input-group">
            <mat-icon fontSet="material-icons-outlined">lock</mat-icon>
            <input
              [id]="field.name"
              [type]="field.type"
              [formControlName]="field.name"
              [placeholder]="field.placeholder"
              required
              #passwordInput
            />
            @if (field.type === 'password') {
              <button
                mat-icon-button
                type="button"
                class="visibility-toggle"
                [appTogglePassword]="passwordInput"
              >
                <mat-icon>visibility_off</mat-icon>
              </button>
            }
          </div>
        </div>

        <!-- Display validation errors -->
        @if (resetForm.get(field.name)?.touched) {
          <div class="error">
            @if (resetForm.get(field.name)?.hasError('required')) {
              {{ field.label }} is required.
            } @else if (resetForm.get('password')?.hasError('pattern')) {
              @if (resetForm.get('password')?.value?.includes(' ')) {
                Password cannot contain spaces.
              } @else {
                Password must be at least 8 characters long and include uppercase, lowercase,
                number, and special character.
              }
            } @else if (
              field.name === 'confirmPassword' &&
              !resetForm.get('confirmPassword')?.hasError('required') &&
              resetForm.hasError('passwordMismatch')
            ) {
              Passwords do not match.
            }
          </div>
        }
      }

      <!-- Global error message display -->
      @if (errorMessage) {
        <div class="error">{{ errorMessage }}</div>
      }

      <!-- Submit button with loading indicator -->
      <app-filled-button [filledButtonConfig]="sendResetLinkButton" class="signin-button">
        @if (isLoading) {
          <span class="loader"></span>
        }
      </app-filled-button>
    </form>
  </div>
</div>
